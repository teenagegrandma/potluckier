/**
 * Revision info generator for static resource dist.
 *
 * @author Allex Wang (allex.wxn@gmail.com)
 */
var fs = require('fs-x')
  , path = require('path')
  ;

function sha1sum(file, isShort) {
  return fs.sha1sumSync(file);
}

module.exports = function(dir, options) {
  options = options || {};

  var list = fs.find(dir, {type: 'file', ignoreRe: /\.(svn|git|cvs)/});

  if (typeof options.filter === 'function') {
      list = list.filter(options.filter);
  }

  list = list.map(function(f) {
    var filepath = path.resolve(f), filename = path.relative(dir, filepath), checksum = sha1sum(filepath);
    return {
      name: filename, // file relative path
      hash: checksum  // sha1sum
    };
  });

  return list;
};

//  vim: set fdm=marker ts=2 sw=2 sts=2 tw=85 et :
